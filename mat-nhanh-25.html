<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Math Quiz App - Thầy Trung KT</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen p-4">
  <div class="max-w-3xl mx-auto">
    
    <!-- Header -->
    <div class="text-center mb-6 relative">
      <h1 class="text-4xl font-bold text-blue-700 mb-2">MẮT NHANH - THÔNG NÃO NÀO!!!</h1>
      <button id="btnAdmin" class="absolute top-0 right-0 bg-gray-200 hover:bg-gray-300 p-3 rounded-full text-2xl">⚙️</button>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" style="display: none;" class="bg-purple-100 border-2 border-purple-400 rounded-2xl p-4 mb-4">
      <p class="text-center font-semibold text-purple-800 mb-3">🔐 Chế độ Admin</p>
      <div class="flex flex-wrap gap-2 justify-center">
        <button id="btnEdit" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold">✏️ Chỉnh sửa</button>
        <button id="btnAdd" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold">+ Thêm câu</button>
        <button id="btnDelete" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold">🗑️ Xóa câu</button>
      </div>
    </div>

    <!-- Navigation -->
    <div id="navContainer" class="mb-4"></div>

    <!-- Main Quiz Area -->
    <div class="bg-white rounded-3xl shadow-xl p-4 mb-6 border-4 border-blue-600">
      
      <!-- Question Image -->
      <div id="questionImage" class="mb-6">
        <div class="bg-gray-100 rounded-xl p-12 text-center text-gray-500">
          📄 Chưa có hình ảnh đề bài
        </div>
      </div>

      <!-- Answers Grid -->
      <div id="answersContainer" class="grid grid-cols-2 gap-2 mb-6">
        <button class="bg-blue-400 rounded-2xl shadow-lg p-6 border-4 border-white flex items-center justify-between">
          <div class="flex items-center gap-3">
            <span class="text-2xl">👍</span>
            <span class="text-3xl font-bold text-blue-900">?</span>
          </div>
        </button>
        <button class="bg-pink-400 rounded-2xl shadow-lg p-6 border-4 border-white flex items-center justify-between">
          <div class="flex items-center gap-3">
            <span class="text-2xl">❤️</span>
            <span class="text-3xl font-bold text-blue-900">?</span>
          </div>
        </button>
        <button class="bg-yellow-400 rounded-2xl shadow-lg p-6 border-4 border-white flex items-center justify-between">
          <div class="flex items-center gap-3">
            <span class="text-2xl">😕</span>
            <span class="text-3xl font-bold text-blue-900">?</span>
          </div>
        </button>
        <button class="bg-orange-400 rounded-2xl shadow-lg p-6 border-4 border-white flex items-center justify-between">
          <div class="flex items-center gap-3">
            <span class="text-2xl">😊</span>
            <span class="text-3xl font-bold text-blue-900">?</span>
          </div>
        </button>
      </div>

      <!-- Result -->
      <div id="resultContainer"></div>

      <!-- Vote Statistics -->
      <div id="statsContainer" class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-4 mb-4">
        <div class="flex items-center justify-around gap-2">
          <div class="flex items-center gap-2">
            <span class="text-lg sm:text-2xl">👍</span>
            <span class="text-xl font-bold text-blue-800">0</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-lg sm:text-2xl">❤️</span>
            <span class="text-xl font-bold text-blue-800">0</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-lg sm:text-2xl">😕</span>
            <span class="text-xl font-bold text-blue-800">0</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-lg sm:text-2xl">😊</span>
            <span class="text-xl font-bold text-blue-800">0</span>
          </div>
        </div>
      </div>

      <!-- Explanation -->
      <div id="explanationContainer"></div>

      <!-- Footer -->
      <div class="text-center">
        <p class="text-xl font-bold text-blue-700">HỌC TOÁN CÙNG THẦY TRUNG KT</p>
        <p id="statusText" class="text-sm text-gray-600 mt-2"></p>
      </div>
    </div>

    <!-- Editor Panel -->
    <div id="editorPanel" style="display: none;" class="bg-white rounded-2xl shadow-xl p-6 mb-6">
      <h3 class="text-xl font-bold mb-4 text-center text-purple-700">
        Chỉnh sửa câu hỏi <span id="editorIndex">1/1</span>
      </h3>

      <!-- Question Image Upload -->
      <div class="mb-4">
        <label class="block font-semibold mb-2 text-gray-700">📸 Hình ảnh đề bài:</label>
        <div id="dropQuestion" class="border-4 border-dashed border-blue-300 hover:border-blue-500 rounded-xl p-6 text-center cursor-pointer">
          <p class="text-gray-600 mb-2">Kéo thả hoặc nhấn để chọn ảnh</p>
          <p class="text-xs text-gray-500">(PNG, JPG - tối đa 5MB)</p>
          <div id="previewQuestion" class="mt-4"></div>
        </div>
        <input type="file" id="inputQuestion" accept="image/*" style="display: none;" />
      </div>

      <!-- Correct Answer Selection -->
      <div class="mb-4">
        <label class="block font-semibold mb-2 text-gray-700">✅ Đáp án đúng:</label>
        <select id="selectCorrect" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg font-semibold">
          <option value="0">Đáp án A</option>
          <option value="1">Đáp án B</option>
          <option value="2">Đáp án C</option>
          <option value="3">Đáp án D</option>
        </select>
      </div>

      <!-- Answers Input -->
      <div class="mb-4">
        <label class="block font-semibold mb-2 text-gray-700">✏️ Nội dung các đáp án:</label>
        <div class="grid grid-cols-1 gap-3">
          <div>
            <div class="flex items-center gap-2 mb-1">
              <div class="w-8 h-8 rounded-full bg-blue-400 text-white flex items-center justify-center font-bold">A</div>
              <span class="font-semibold">Đáp án A</span>
            </div>
            <input type="text" id="answer0" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg" placeholder="Nhập đáp án A" />
          </div>
          <div>
            <div class="flex items-center gap-2 mb-1">
              <div class="w-8 h-8 rounded-full bg-pink-400 text-white flex items-center justify-center font-bold">B</div>
              <span class="font-semibold">Đáp án B</span>
            </div>
            <input type="text" id="answer1" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg" placeholder="Nhập đáp án B" />
          </div>
          <div>
            <div class="flex items-center gap-2 mb-1">
              <div class="w-8 h-8 rounded-full bg-yellow-400 text-white flex items-center justify-center font-bold">C</div>
              <span class="font-semibold">Đáp án C</span>
            </div>
            <input type="text" id="answer2" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg" placeholder="Nhập đáp án C" />
          </div>
          <div>
            <div class="flex items-center gap-2 mb-1">
              <div class="w-8 h-8 rounded-full bg-orange-400 text-white flex items-center justify-center font-bold">D</div>
              <span class="font-semibold">Đáp án D</span>
            </div>
            <input type="text" id="answer3" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg" placeholder="Nhập đáp án D" />
          </div>
        </div>
      </div>

      <!-- Explanation Image Upload -->
      <div class="mb-4">
        <label class="block font-semibold mb-2 text-gray-700">📖 Hình ảnh lời giải:</label>
        <div id="dropExplanation" class="border-4 border-dashed border-green-300 hover:border-green-500 rounded-xl p-6 text-center cursor-pointer">
          <p class="text-gray-600 mb-2">Kéo thả hoặc nhấn để chọn ảnh lời giải</p>
          <p class="text-xs text-gray-500">(PNG, JPG - tối đa 5MB)</p>
          <div id="previewExplanation" class="mt-4"></div>
        </div>
        <input type="file" id="inputExplanation" accept="image/*" style="display: none;" />
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-wrap gap-3">
        <button id="btnSave" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-xl font-bold">💾 Lưu</button>
        <button id="btnResetOne" class="flex-1 bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-xl font-bold">🔄 Reset câu này</button>
        <button id="btnResetAll" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white py-3 rounded-xl font-bold">🔄 Reset tất cả</button>
      </div>
    </div>

  </div>

  <script>
    const CONFIG = {
      storageKey: 'mathQuizData_v3',
      adminPassword: '123456',
      maxFileSize: 5 * 1024 * 1024,
      icons: ['👍', '❤️', '😕', '😊'],
      colors: ['bg-blue-200', 'bg-pink-200', 'bg-yellow-200', 'bg-orange-200']
    };

    const state = {
      questions: [],
      currentIndex: 0,
      isAdmin: false,
      isEditing: false,
      userAnswer: null,
      hasAnswered: false,
      showExplanation: false
    };

    function initData() {
      return [{
        id: Date.now(),
        questionImage: null,
        answers: ['', '', '', ''],
        correctAnswer: 0,
        explanationImage: null,
        votes: [0, 0, 0, 0]
      }];
    }

    function saveData() {
      localStorage.setItem(CONFIG.storageKey, JSON.stringify(state.questions));
    }

    function loadData() {
      try {
        const data = localStorage.getItem(CONFIG.storageKey);
        state.questions = data ? JSON.parse(data) : initData();
        if (state.questions.length === 0) state.questions = initData();
      } catch (e) {
        state.questions = initData();
      }
    }

    function showElement(id, show) {
      const el = document.getElementById(id);
      el.style.display = show ? 'block' : 'none';
    }

    function renderNav() {
      const container = document.getElementById('navContainer');
      container.innerHTML = '';
      
      if (state.questions.length <= 1) return;

      const nav = document.createElement('div');
      nav.className = 'bg-white rounded-2xl shadow-lg p-4';
      
      const buttons = document.createElement('div');
      buttons.className = 'flex gap-2 overflow-x-auto';
      
      state.questions.forEach((q, i) => {
        const btn = document.createElement('button');
        btn.className = `px-4 py-2 rounded-lg font-semibold whitespace-nowrap ${
          i === state.currentIndex ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
        }`;
        btn.textContent = `Câu ${i + 1}`;
        btn.onclick = () => goToQuestion(i);
        buttons.appendChild(btn);
      });
      
      nav.appendChild(buttons);
      container.appendChild(nav);
    }

    function renderQuestionImage() {
      const container = document.getElementById('questionImage');
      const q = state.questions[state.currentIndex];
      
      container.innerHTML = '';
      
      if (q.questionImage) {
        const img = document.createElement('img');
        img.src = q.questionImage;
        img.className = 'w-full rounded-xl shadow-md';
        container.appendChild(img);
      } else {
        const placeholder = document.createElement('div');
        placeholder.className = 'bg-gray-100 rounded-xl p-12 text-center text-gray-500';
        placeholder.textContent = '📄 Chưa có hình ảnh đề bài';
        container.appendChild(placeholder);
      }
    }

    function renderAnswers() {
      const container = document.getElementById('answersContainer');
      const q = state.questions[state.currentIndex];
      
      container.innerHTML = '';

      container.style.display = 'grid';

      q.answers.forEach((answer, i) => {
        const isEmpty = !answer || answer.trim() === '';
        if (!state.isAdmin && !state.isEditing && isEmpty) return;

        const btn = document.createElement('button');
        const isCorrect = i === q.correctAnswer;
        const isUserChoice = state.userAnswer === i;
        const isWrong = state.hasAnswered && isUserChoice && !isCorrect;

        let classes = `${CONFIG.colors[i]} rounded-2xl shadow-lg p-4 border-4 flex flex-col items-center justify-center `;

        if (state.hasAnswered) {
          if (isCorrect) {
            classes += 'border-green-700 ';
          } else if (isWrong) {
            classes = 'bg-red-500 rounded-2xl shadow-lg p-4 border-4 border-red-700 flex flex-col items-center justify-center ';
          } else {
            classes += 'border-white opacity-60 ';
          }
        } else {
          classes += isUserChoice ? 'border-blue-700 ' : 'border-white ';
        }

        if (state.hasAnswered || state.isAdmin || state.isEditing) {
          btn.disabled = true;
          if (!state.hasAnswered) classes += 'opacity-50 cursor-not-allowed ';
        } else {
          classes += 'hover:scale-105 transition-transform cursor-pointer ';
        }

        btn.className = classes;
        btn.onclick = () => handleAnswer(i);
        btn.style.position = 'relative';

        const iconDiv = document.createElement('div');
        iconDiv.className = `w-14 h-14 rounded-full ${CONFIG.colors[i]} border-4 border-white text-white flex items-center justify-center text-3xl font-bold absolute top-1/2 left-0 transform -translate-y-1/2 z-20`;
        iconDiv.textContent = CONFIG.icons[i];
        btn.appendChild(iconDiv);

        if (!isEmpty) {
          const text = document.createElement('div');
          text.className = 'text-2xl font-bold text-blue-900 text-center';
          text.textContent = answer;
          btn.appendChild(text);
        }

        container.appendChild(btn);
      });
    }

    function renderResult() {
      const container = document.getElementById('resultContainer');
      const q = state.questions[state.currentIndex];

      container.innerHTML = '';

      if (state.hasAnswered) {
        const box = document.createElement('div');
        box.className = 'text-center mb-6';

        const icon = document.createElement('div');
        icon.className = 'text-4xl';

        const message = document.createElement('p');
        message.className = 'text-2xl font-bold text-gray-700 ml-2';

        const isCorrect = state.userAnswer === q.correctAnswer;
        if (isCorrect) {
          icon.textContent = '🎉';
          message.textContent = 'Chúc mừng! Bạn đã chọn đúng!';
          box.className += ' bg-green-50 border-4 border-green-400 rounded-2xl p-6 flex items-center justify-center';
          message.className += ' text-green-700';
        } else {
          icon.textContent = '🍀';
          message.textContent = 'Chúc bạn may mắn lần sau      !!!';
          box.className += ' bg-orange-50 border-4 border-orange-400 rounded-2xl p-6 flex items-center justify-center';
          message.className += ' text-orange-700';
        }

        box.appendChild(icon);
        box.appendChild(message);

        // Add button to show explanation
        const btnShow = document.createElement('button');
        btnShow.className = 'mt-4 bg-blue-200 hover:bg-blue-100 text-black px-4 py-2 rounded-lg font-semibold';
        btnShow.textContent = '📖Hiện lời giải';
        btnShow.onclick = () => { state.showExplanation = true; renderExplanation(); };
        box.appendChild(btnShow);
        container.appendChild(box);
      }
    }

    function renderExplanation() {
      const container = document.getElementById('explanationContainer');
      const q = state.questions[state.currentIndex];

      if (!state.showExplanation) {
        container.innerHTML = '';
        return;
      }

      container.innerHTML = '';
      
      if (state.hasAnswered && q.explanationImage) {
        const box = document.createElement('div');
        box.className = 'bg-green-50 border-4 border-green-400 rounded-2xl p-6 mb-6';
        
        const title = document.createElement('h3');
        title.className = 'text-2xl font-bold text-green-700 mb-4 text-center';
        title.textContent = '📚 Lời giải chi tiết';
        
        const img = document.createElement('img');
        img.src = q.explanationImage;
        img.className = 'w-full rounded-xl shadow-md';
        
        box.appendChild(title);
        box.appendChild(img);
        container.appendChild(box);
      }
    }

    function renderStats() {
      const container = document.getElementById('statsContainer');
      const q = state.questions[state.currentIndex];
      
      container.innerHTML = '';
      
      const row = document.createElement('div');
      row.className = 'flex items-center justify-around gap-2';

      q.votes.forEach((votes, i) => {
        const item = document.createElement('div');
        item.className = 'flex items-center gap-2';

        const icon = document.createElement('span');
        icon.className = 'text-lg sm:text-3xl';
        icon.textContent = CONFIG.icons[i];

        const count = document.createElement('span');
        count.className = 'text-lg sm:text-xl font-bold text-blue-800';
        count.textContent = votes;
        
        item.appendChild(icon);
        item.appendChild(count);
        row.appendChild(item);
      });
      
      container.appendChild(row);
    }

    function renderStatus() {
      const el = document.getElementById('statusText');
      if (state.hasAnswered) {
        const q = state.questions[state.currentIndex];
        el.textContent = `Bạn đã chọn: ${q.answers[state.userAnswer]}`;
      } else {
        el.textContent = '';
      }
    }

    function renderEditor() {
      const q = state.questions[state.currentIndex];
      
      document.getElementById('editorIndex').textContent = `${state.currentIndex + 1}/${state.questions.length}`;
      document.getElementById('selectCorrect').value = q.correctAnswer;
      
      for (let i = 0; i < 4; i++) {
        document.getElementById(`answer${i}`).value = q.answers[i] || '';
      }
      
      const previewQ = document.getElementById('previewQuestion');
      previewQ.innerHTML = '';
      if (q.questionImage) {
        const img = document.createElement('img');
        img.src = q.questionImage;
        img.className = 'max-w-full max-h-48 mx-auto rounded-lg';
        previewQ.appendChild(img);
      }
      
      const previewE = document.getElementById('previewExplanation');
      previewE.innerHTML = '';
      if (q.explanationImage) {
        const img = document.createElement('img');
        img.src = q.explanationImage;
        img.className = 'max-w-full max-h-48 mx-auto rounded-lg';
        previewE.appendChild(img);
      }
    }

    function render() {
      renderNav();
      renderQuestionImage();
      renderAnswers();
      renderResult();
      renderExplanation();
      renderStats();
      renderStatus();
      
      showElement('adminPanel', state.isAdmin);
      showElement('editorPanel', state.isEditing);
      
      if (state.isEditing) renderEditor();
    }

    function goToQuestion(index) {
      state.currentIndex = index;
      state.userAnswer = null;
      state.hasAnswered = false;
      state.showExplanation = false;
      render();
    }

    function handleAnswer(index) {
      if (state.hasAnswered || state.isAdmin || state.isEditing) return;
      
      const q = state.questions[state.currentIndex];
      
      if (state.userAnswer !== null) {
        q.votes[state.userAnswer] = Math.max(0, q.votes[state.userAnswer] - 1);
      }
      
      q.votes[index]++;
      state.userAnswer = index;
      state.hasAnswered = true;
      
      saveData();
      render();
    }

    function handleAdmin() {
      if (!state.isAdmin) {
        const pwd = prompt('🔐 Nhập mật khẩu admin:');
        if (pwd !== CONFIG.adminPassword) {
          alert('❌ Sai mật khẩu!');
          return;
        }
      }
      
      state.isAdmin = !state.isAdmin;
      if (!state.isAdmin) state.isEditing = false;
      render();
    }

    function handleEdit() {
      state.isEditing = true;
      render();
    }

    function handleSave() {
      const q = state.questions[state.currentIndex];
      
      for (let i = 0; i < 4; i++) {
        q.answers[i] = document.getElementById(`answer${i}`).value;
      }
      
      q.correctAnswer = parseInt(document.getElementById('selectCorrect').value);
      
      saveData();
      state.isEditing = false;
      render();
      alert('✅ Đã lưu!');
    }

    function handleAdd() {
      state.questions.push({
        id: Date.now(),
        questionImage: null,
        answers: ['', '', '', ''],
        correctAnswer: 0,
        explanationImage: null,
        votes: [0, 0, 0, 0]
      });
      
      state.currentIndex = state.questions.length - 1;
      state.userAnswer = null;
      state.hasAnswered = false;
      
      saveData();
      render();
    }

    function handleDelete() {
      if (state.questions.length === 1) {
        alert('⚠️ Phải có ít nhất 1 câu!');
        return;
      }
      
      if (!confirm('🗑️ Xóa câu này?')) return;
      
      state.questions.splice(state.currentIndex, 1);
      if (state.currentIndex >= state.questions.length) {
        state.currentIndex = state.questions.length - 1;
      }
      
      state.userAnswer = null;
      state.hasAnswered = false;
      
      saveData();
      render();
    }

    function handleResetOne() {
      if (!confirm('🔄 Reset vote câu này?')) return;
      
      state.questions[state.currentIndex].votes = [0, 0, 0, 0];
      state.userAnswer = null;
      state.hasAnswered = false;
      
      saveData();
      render();
    }

    function handleResetAll() {
      if (!confirm('🔄 Reset tất cả vote?')) return;
      
      state.questions.forEach(q => q.votes = [0, 0, 0, 0]);
      state.userAnswer = null;
      state.hasAnswered = false;
      
      saveData();
      render();
    }

    function handleImageUpload(file, type) {
      if (!file) return;
      
      if (file.size > CONFIG.maxFileSize) {
        alert('⚠️ File quá lớn! Tối đa 5MB.');
        return;
      }
      
      if (!file.type.startsWith('image/')) {
        alert('⚠️ Chỉ chấp nhận file ảnh!');
        return;
      }
      
      const reader = new FileReader();
      reader.onload = (e) => {
        const q = state.questions[state.currentIndex];
        
        if (type === 'question') {
          q.questionImage = e.target.result;
        } else {
          q.explanationImage = e.target.result;
        }
        
        saveData();
        renderEditor();
        render();
      };
      reader.readAsDataURL(file);
    }

    function setupDrop(dropId, inputId, type) {
      const drop = document.getElementById(dropId);
      const input = document.getElementById(inputId);
      
      drop.onclick = () => input.click();
      
      drop.ondragover = (e) => {
        e.preventDefault();
        drop.style.borderColor = '#3b82f6';
      };
      
      drop.ondragleave = () => {
        drop.style.borderColor = '';
      };
      
      drop.ondrop = (e) => {
        e.preventDefault();
        drop.style.borderColor = '';
        handleImageUpload(e.dataTransfer.files[0], type);
      };
      
      input.onchange = (e) => {
        handleImageUpload(e.target.files[0], type);
      };
    }

    function init() {
      loadData();
      render();
      
      document.getElementById('btnAdmin').onclick = handleAdmin;
      document.getElementById('btnEdit').onclick = handleEdit;
      document.getElementById('btnSave').onclick = handleSave;
      document.getElementById('btnAdd').onclick = handleAdd;
      document.getElementById('btnDelete').onclick = handleDelete;
      document.getElementById('btnResetOne').onclick = handleResetOne;
      document.getElementById('btnResetAll').onclick = handleResetAll;
      
      setupDrop('dropQuestion', 'inputQuestion', 'question');
      setupDrop('dropExplanation', 'inputExplanation', 'explanation');
    }

    init();
  </script>
</body>
</html>